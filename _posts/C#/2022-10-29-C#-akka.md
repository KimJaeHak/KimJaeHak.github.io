---
title: "C# akka.net"
categories:
 - C#
tags:
 - C#
 - akka
 - akka.net
---

- [Actor Models and Akka.net](#actor-models-and-akkanet)
  - [Why Use Actor Models](#why-use-actor-models)
  - [Actors 의 특징](#actors-의-특징)
  - [Message](#message)
  - [Actor System](#actor-system)
  - [Akka Nuget Packages](#akka-nuget-packages)
  - [Actor System 생성 Code](#actor-system-생성-code)
- [Actor 사용방법 및 메세지](#actor-사용방법-및-메세지)
  - [Actor 정의 및 올바른 사용](#actor-정의-및-올바른-사용)
  - [Actor Refrence(참조)](#actor-refrence참조)
  - [Message 정의 및 사용](#message-정의-및-사용)
  - [Actor 생성 및 Props](#actor-생성-및-props)
  - [Send Simple & Custom Message](#send-simple--custom-message)
  - [Actor 생성 및 Message 예제](#actor-생성-및-message-예제)

# Actor Models and Akka.net

## Why Use Actor Models
<img src="/assets/images/auto/2022-10-31-11-04-17.png" width="60%">  

## Actors 의 특징
<img src="/assets/images/auto/2022-10-31-11-12-14.png" width="60%">  
<img src="/assets/images/auto/2022-10-31-11-15-49.png" width="60%">  

## Message

> - Simple POCO class
> - Actors can change state when responding
> - to messages
> - Message instances should be immutable
> - The passing of messages is asynchronous
  
**Mesaage Class**
```cs
public class Message
{
    public Message(int customerId)
    {
        CustomerId = customerId;
    }
    public int CustomerId { get; private set; }
    }
}
```

## Actor System
> Actor System은 Remove나 Local에 상관 없이 동작 한다.
> Actor들은 Remove/Local에 대한 Dependency가 없다.(전혀 알지 못함)

<img src="/assets/images/auto/2022-10-31-11-20-41.png" width="60%">

## Akka Nuget Packages
- Akka를 사용하기 위해서 필요한 패키지 종류들
<img src="/assets/images/auto/2022-10-31-11-26-29.png" width="60%">

## Actor System 생성 Code

```cs
    class Program
    {
        private static ActorSystem MovieStreamingActorSystem;

        static void Main(string[] args)
        {
            MovieStreamingActorSystem = ActorSystem.Create("MovieStreamingActorSystem");
            //Actor System Terminate
            MovieStreamingActorSystem.Shutdown();
        }
    }
```

# Actor 사용방법 및 메세지  

## Actor 정의 및 올바른 사용
 - Actor정의
    1. Class정의
    2. Akka.net Base Class를 상속
    3. Message Handling을 정의  

## Actor Refrence(참조)
  - Actor의 참조를 얻는 방법
   - Create New Actor
     - ActorOf()
   - Lookup existing Actor
     - ActorSelection()  

## Message 정의 및 사용
 - Message정의
   1. POCO클래스 생성
   2. Add Properties
   3. Setters private
 - Message 종류
   - Tell
     - 다른 Actor에게 보냄
     - 응답을 기대하지 않음(단방향)
     - Fire And Forget
     - Non-Block으로 동작
     - 확장 및 동시성에서 좋음
     - 가장 많이 사용
   - Ask
     - 다른 Actor에게 보냄
     - 응답을 기대함
     - 수신 Actor는 반드시 응답을 해야함
     - 확장 및 동시성에 제한
     - 필요 할때 조건부로 사용
   - Forward
     - Broad Casting에서 사용할 같음(예상)  

## Actor 생성 및 Props  
 - Actor Instance(생성)
   1. Props 정의
   2. Instance name
   3. Props & name을 통해서 생성
 - Props란?
   - Actor를 생성 하기 위한 Recipe
   - Actor System이 Actor를 생성하기 위한 정보 및 배포 관련 구성 정보가 들어 있음
> Actor를 생성시 절대 New Keyword를 사용하지 않는다.  
> Factory methods를 통해서 Actor 및 Props를 생성  

## Send Simple & Custom Message
- UntypedActor VS RecivedActor
  - RecivedActor는 처리할 수 있는 Message지정을 필터링 하는 방법이 매우 쉽다.

## Actor 생성 및 Message 예제

```cs
//Program.cs
using System;
using Akka.Actor;
using MovieStreaming.Actors;

namespace MovieStreaming
{
    class Program
    {
        private static ActorSystem MovieStreamingActorSystem;

        static void Main(string[] args)
        {
            MovieStreamingActorSystem = ActorSystem.Create("MovieStreamingActorSystem");
            Console.WriteLine("Actor system created");

            Props playbackActorProps = Props.Create<PlaybackActor>();

            IActorRef playbackActorRef = MovieStreamingActorSystem.ActorOf(playbackActorProps, "PlaybackActor");

            Console.ReadLine();

            MovieStreamingActorSystem.Shutdown();
        }
    }
}
```  
 > - UntypedActor 와 RecivedActor의 Message 처리 차이 예제  

```cs
//Untype Actor
public class PlaybackActor : UntypedActor
{

    public PlaybackActor()
    {
        Console.WriteLine("Creating a PlaybackActor");
    }
    protected override void OnReceive(object message)
    {
        if (message is PlayMovieMessage)
        {
            var m = message as PlayMovieMessage;

            Console.WriteLine("Received movie title " + m.MovieTitle);
            Console.WriteLine("Received user Id " + m.UserId);
        }
        else
        {
            Unhandled(message);
        }
    }
}

// Recived Actor
public class PlaybackActor : ReceiveActor
{
    public PlaybackActor()
    {
        Console.WriteLine("Creating a PlaybackActor");

        Receive<PlayMovieMessage>(message => HandlePlayMovieMessage(message), message => message.UserId == 42);
    }

    private void HandlePlayMovieMessage(PlayMovieMessage message)
    {
        Console.WriteLine("Received movie title " + message.MovieTitle);
        Console.WriteLine("Received user Id " + message.UserId);
    }
}
```

> Recived Actor의 Message Handling 코드가 훨신 가독성이 좋다.